detect:
  log type: wel
  op: and
  rules:
  - case sensitive: false
    op: is
    path: Event/System/EventID
    value: '4625'
  - not: true
    op: or
    rules:
    - case sensitive: false
      op: contains
      path: Event/EventData/IpAddress
      value: '-'
    - op: or
      rules:
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: '10.'
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 192.168.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.16.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.17.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.18.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.19.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.20.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.21.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.22.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.23.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.24.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.25.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.26.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.27.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.28.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.29.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.30.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 172.31.
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: '127.'
      - case sensitive: false
        op: starts with
        path: Event/EventData/IpAddress
        value: 169.254.
    - op: or
      rules:
      - case sensitive: false
        op: is
        path: Event/EventData/IpAddress
        value: ::1
      - op: or
        rules:
        - case sensitive: false
          op: starts with
          path: Event/EventData/IpAddress
          value: 'fe80::'
        - case sensitive: false
          op: starts with
          path: Event/EventData/IpAddress
          value: 'fc00::'
  target: log
respond:
- action: report
  metadata:
    author: NVISO
    description: Detects a failed logon attempt from a public IP. A login from a public
      IP can indicate a misconfigured firewall or network boundary.
    falsepositives:
    - Legitimate logon attempts over the internet
    - IPv4-to-IPv6 mapped IPs
    level: medium
    references:
    - https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4625
    tags:
    - attack.initial_access
    - attack.persistence
    - attack.t1078
    - attack.t1190
    - attack.t1133
  name: Failed Logon From Public IP

