detect:
  event: WEL
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - op: or
      rules:
      - op: and
        rules:
        - case sensitive: false
          op: is
          path: event/EVENT/System/EventID
          value: '4624'
        - case sensitive: false
          op: is
          path: event/EVENT/EventData/SubjectUserSid
          value: S-1-0-0
        - case sensitive: false
          op: is
          path: event/EVENT/EventData/LogonType
          value: '3'
        - case sensitive: false
          op: is
          path: event/EVENT/EventData/LogonProcessName
          value: NtLmSsp
        - case sensitive: false
          op: is
          path: event/EVENT/EventData/KeyLength
          value: '0'
      - op: and
        rules:
        - case sensitive: false
          op: is
          path: event/EVENT/System/EventID
          value: '4624'
        - case sensitive: false
          op: is
          path: event/EVENT/EventData/LogonType
          value: '9'
        - case sensitive: false
          op: is
          path: event/EVENT/EventData/LogonProcessName
          value: seclogo
    - case sensitive: false
      not: true
      op: is
      path: event/EVENT/EventData/TargetUserName
      value: ANONYMOUS LOGON
respond:
- action: report
  metadata:
    author: Dave Kennedy, Jeff Warren (method) / David Vassallo (rule)
    description: Detects the attack technique pass the hash which is used to move
      laterally inside the network
    falsepositives:
    - Administrator activity
    level: medium
    references:
    - https://github.com/iadgov/Event-Forwarding-Guidance/tree/master/Events
    - https://blog.binarydefense.com/reliably-detecting-pass-the-hash-through-event-log-analysis
    - https://blog.stealthbits.com/how-to-detect-pass-the-hash-attacks/
    tags:
    - attack.lateral_movement
    - attack.t1550.002
  name: Pass the Hash Activity 2

