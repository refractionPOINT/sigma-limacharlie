detect:
  event: WEL
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - case sensitive: false
      op: is
      path: event/EVENT/System/EventID
      value: '4616'
    - not: true
      op: or
      rules:
      - op: or
        rules:
        - case sensitive: false
          op: is
          path: event/EVENT/EventData/ProcessName
          value: C:\Program Files\VMware\VMware Tools\vmtoolsd.exe
        - case sensitive: false
          op: is
          path: event/EVENT/EventData/ProcessName
          value: C:\Windows\System32\VBoxService.exe
        - case sensitive: false
          op: is
          path: event/EVENT/EventData/ProcessName
          value: C:\Windows\System32\oobe\msoobe.exe
      - op: and
        rules:
        - case sensitive: false
          op: is
          path: event/EVENT/EventData/ProcessName
          value: C:\Windows\System32\svchost.exe
        - case sensitive: false
          op: is
          path: event/EVENT/EventData/SubjectUserSid
          value: S-1-5-19
respond:
- action: report
  metadata:
    author: '@neu5ron'
    description: Detect scenarios where a potentially unauthorized application or
      user is modifying the system time.
    falsepositives:
    - HyperV or other virtualization technologies with binary not listed in filter
      portion of detection
    level: low
    references:
    - Private Cuckoo Sandbox (from many years ago, no longer have hash, NDA as well)
    - Live environment caused by malware
    - https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4616
    tags:
    - attack.defense_evasion
    - attack.t1070.006
  name: Unauthorized System Time Modification

