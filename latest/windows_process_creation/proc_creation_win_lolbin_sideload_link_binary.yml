detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - op: and
      rules:
      - case sensitive: false
        op: ends with
        path: event/FILE_PATH
        value: \link.exe
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: LINK /
    - not: true
      op: and
      rules:
      - op: or
        rules:
        - case sensitive: false
          op: starts with
          path: event/PARENT/FILE_PATH
          value: C:\Program Files\Microsoft Visual Studio\
        - case sensitive: false
          op: starts with
          path: event/PARENT/FILE_PATH
          value: C:\Program Files (x86)\Microsoft Visual Studio\
      - case sensitive: false
        op: contains
        path: event/PARENT/FILE_PATH
        value: \VC\Tools\MSVC\
respond:
- action: report
  metadata:
    author: Nasreddine Bencherchali
    description: Detects the execution utitilies often found in Visual Studio tools
      that hardcode the call to the binary "link.exe". They can be abused to sideload
      any binary with the same name
    falsepositives:
    - Unknown
    level: medium
    references:
    - https://twitter.com/0gtweet/status/1560732860935729152
    tags:
    - attack.defense_evasion
    - attack.t1218
  name: Sideloading Link.EXE

