detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - op: or
      rules:
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: echo
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: copy
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: type
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: file createnew
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: cacls
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: C:\Windows\Fonts\
    - op: or
      rules:
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .sh
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .exe
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .dll
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .bin
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .bat
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .cmd
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .js
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .msh
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .reg
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .scr
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .ps
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .vb
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .jar
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .pl
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: '.inf'
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .cpl
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .hta
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .msi
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: .vbs
respond:
- action: report
  metadata:
    author: Sreeman
    description: Monitors for the hiding possible malicious files in the C:\Windows\Fonts\
      location. This folder doesn't require admin privillege to be written and executed
      from.
    falsepositives:
    - Unknown
    level: medium
    references:
    - https://thedfirreport.com/2020/04/20/sqlserver-or-the-miner-in-the-basement/
    tags:
    - attack.t1211
    - attack.t1059
    - attack.defense-evasion
    - attack.persistence
  name: Writing Of Malicious Files To The Fonts Folder

