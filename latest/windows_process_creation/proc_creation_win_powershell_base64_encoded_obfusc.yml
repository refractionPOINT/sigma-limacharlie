detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: or
    rules:
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: IAAtAGIAeABvAHIAIAAwAHgA
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AALQBiAHgAbwByACAAMAB4A
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: gAC0AYgB4AG8AcgAgADAAeA
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AC4ASQBuAHYAbwBrAGUAKAApACAAfAAg
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AuAEkAbgB2AG8AawBlACgAKQAgAHwAI
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: ALgBJAG4AdgBvAGsAZQAoACkAIAB8AC
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AHsAMQB9AHsAMAB9ACIAIAAtAGYAI
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: B7ADEAfQB7ADAAfQAiACAALQBmAC
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AewAxAH0AewAwAH0AIgAgAC0AZgAg
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AHsAMAB9AHsAMwB9ACIAIAAtAGYAI
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: B7ADAAfQB7ADMAfQAiACAALQBmAC
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AewAwAH0AewAzAH0AIgAgAC0AZgAg
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AHsAMgB9AHsAMAB9ACIAIAAtAGYAI
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: B7ADIAfQB7ADAAfQAiACAALQBmAC
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AewAyAH0AewAwAH0AIgAgAC0AZgAg
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AHsAMQB9AHsAMAB9ACcAIAAtAGYAI
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: B7ADEAfQB7ADAAfQAnACAALQBmAC
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AewAxAH0AewAwAH0AJwAgAC0AZgAg
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AHsAMAB9AHsAMwB9ACcAIAAtAGYAI
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: B7ADAAfQB7ADMAfQAnACAALQBmAC
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AewAwAH0AewAzAH0AJwAgAC0AZgAg
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AHsAMgB9AHsAMAB9ACcAIAAtAGYAI
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: B7ADIAfQB7ADAAfQAnACAALQBmAC
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: AewAyAH0AewAwAH0AJwAgAC0AZgAg
respond:
- action: report
  metadata:
    author: Florian Roth (Nextron Systems)
    description: Detects suspicious UTF16 and base64 encoded and often obfuscated
      PowerShell code often used in command lines
    falsepositives:
    - Unknown
    level: high
    references:
    - https://app.any.run/tasks/fcadca91-3580-4ede-aff4-4d2bf809bf99/
    tags:
    - attack.defense_evasion
  name: Suspicious Obfuscated PowerShell Code

