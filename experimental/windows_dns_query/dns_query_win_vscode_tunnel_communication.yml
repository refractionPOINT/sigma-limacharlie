detect:
  case sensitive: false
  event: DNS_REQUEST
  op: ends with
  path: event/DOMAIN_NAME
  value: .tunnels.api.visualstudio.com
respond:
- action: report
  metadata:
    author: citron_ninja
    description: 'Detects DNS query requests to Visual Studio Code tunnel domains.
      Attackers can abuse that feature to establish a reverse shell or persistence
      on a machine.

      '
    falsepositives:
    - Legitimate use of Visual Studio Code tunnel will also trigger this.
    level: medium
    references:
    - https://ipfyx.fr/post/visual-studio-code-tunnel/
    - https://badoption.eu/blog/2023/01/31/code_c2.html
    - https://cydefops.com/vscode-data-exfiltration
    tags:
    - attack.command-and-control
    - attack.t1071.001
  name: DNS Query To Visual Studio Code Tunnels Domain

