detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - op: and
      rules:
      - op: or
        rules:
        - case sensitive: false
          op: ends with
          path: event/FILE_PATH
          value: \reg.exe
        - case sensitive: false
          op: is
          path: event/ORIGINAL_FILE_NAME
          value: reg.exe
      - op: and
        rules:
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: Microsoft\Windows\WindowsAI
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: DisableAIDataAnalysis
    - op: or
      rules:
      - op: or
        rules:
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: add
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: '0'
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: delete
respond:
- action: report
  metadata:
    author: Sajid Nawaz Khan
    description: 'Detects the enabling of the Windows Recall feature via registry
      manipulation.

      Windows Recall can be enabled by deleting the existing "DisableAIDataAnalysis"
      value, or setting it to 0.

      Adversaries may enable Windows Recall as part of post-exploitation discovery
      and collection activities.

      This rule assumes that Recall is already explicitly disabled on the host, and
      subsequently enabled by the adversary.

      '
    falsepositives:
    - Legitimate use/activation of Windows Recall
    level: medium
    references:
    - https://learn.microsoft.com/en-us/windows/client-management/manage-recall
    - https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-windowsai#disableaidataanalysis
    tags:
    - attack.collection
    - attack.t1113
  name: Windows Recall Feature Enabled Via Reg.EXE

