detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - op: and
      rules:
      - op: and
        rules:
        - op: or
          rules:
          - case sensitive: false
            op: ends with
            path: event/FILE_PATH
            value: \AtBroker.exe
          - case sensitive: false
            op: is
            path: event/ORIGINAL_FILE_NAME
            value: AtBroker.exe
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: start
      - not: true
        op: or
        rules:
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: animations
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: audiodescription
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: caretbrowsing
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: caretwidth
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: colorfiltering
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: cursorindicator
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: cursorscheme
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: filterkeys
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: focusborderheight
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: focusborderwidth
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: highcontrast
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: keyboardcues
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: keyboardpref
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: livecaptions
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: magnifierpane
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: messageduration
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: minimumhitradius
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: mousekeys
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: Narrator
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: osk
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: overlappedcontent
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: showsounds
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: soundsentry
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: speechreco
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: stickykeys
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: togglekeys
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: voiceaccess
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: windowarranging
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: windowtracking
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: windowtrackingtimeout
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: windowtrackingzorder
    - case sensitive: false
      not: true
      op: contains
      path: event/COMMAND_LINE
      value: Oracle_JavaAccessBridge
respond:
- action: report
  metadata:
    author: Mateusz Wydra, oscd.community
    description: Detects the start of a non built-in assistive technology applications
      via "Atbroker.EXE".
    falsepositives:
    - Legitimate, non-default assistive technology applications execution
    level: medium
    references:
    - http://www.hexacorn.com/blog/2016/07/22/beyond-good-ol-run-key-part-42/
    - https://lolbas-project.github.io/lolbas/Binaries/Atbroker/
    tags:
    - attack.defense-evasion
    - attack.t1218
  name: Uncommon  Assistive Technology Applications Execution Via AtBroker.EXE

