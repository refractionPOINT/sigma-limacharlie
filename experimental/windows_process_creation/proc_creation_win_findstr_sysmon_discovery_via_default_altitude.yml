detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - op: or
      rules:
      - op: or
        rules:
        - case sensitive: false
          op: ends with
          path: event/FILE_PATH
          value: \find.exe
        - case sensitive: false
          op: ends with
          path: event/FILE_PATH
          value: \findstr.exe
      - op: or
        rules:
        - case sensitive: false
          op: is
          path: event/ORIGINAL_FILE_NAME
          value: FIND.EXE
        - case sensitive: false
          op: is
          path: event/ORIGINAL_FILE_NAME
          value: FINDSTR.EXE
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: ' 385201'
respond:
- action: report
  metadata:
    author: frack113
    description: Detects usage of "findstr" with the argument "385201". Which could
      indicate potential discovery of an installed Sysinternals Sysmon service using
      the default driver altitude (even if the name is changed).
    falsepositives:
    - Unknown
    level: high
    references:
    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1518.001/T1518.001.md#atomic-test-5---security-software-discovery---sysmon-service
    tags:
    - attack.discovery
    - attack.t1518.001
  name: Sysmon Discovery Via Default Driver Altitude Using Findstr.EXE

