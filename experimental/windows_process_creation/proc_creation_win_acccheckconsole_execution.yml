detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - op: or
      rules:
      - case sensitive: false
        op: ends with
        path: event/FILE_PATH
        value: \AccCheckConsole.exe
      - case sensitive: false
        op: is
        path: event/ORIGINAL_FILE_NAME
        value: AccCheckConsole.exe
    - op: or
      rules:
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: ' -hwnd'
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: ' -process '
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: ' -window '
respond:
- action: report
  metadata:
    author: Florian Roth (Nextron Systems)
    description: 'Detects the execution "AccCheckConsole" a command-line tool for
      verifying the accessibility implementation of an application''s UI.

      One of the tests that this checker can run are called "verification routine",
      which tests for things like Consistency, Navigation, etc.

      The tool allows a user to provide a DLL that can contain a custom "verification
      routine". An attacker can build such DLLs and pass it via the CLI, which would
      then be loaded in the context of the "AccCheckConsole" utility.

      '
    falsepositives:
    - Legitimate use of the UI Accessibility Checker
    level: medium
    references:
    - https://gist.github.com/bohops/2444129419c8acf837aedda5f0e7f340
    - https://twitter.com/bohops/status/1477717351017680899?s=12
    - https://lolbas-project.github.io/lolbas/OtherMSBinaries/AccCheckConsole/
    tags:
    - attack.execution
    - detection.threat-hunting
  name: Potential DLL Injection Via AccCheckConsole

