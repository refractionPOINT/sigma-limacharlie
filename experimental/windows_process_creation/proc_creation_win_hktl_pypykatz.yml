detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - op: or
      rules:
      - case sensitive: false
        op: ends with
        path: event/FILE_PATH
        value: \pypykatz.exe
      - case sensitive: false
        op: ends with
        path: event/FILE_PATH
        value: \python.exe
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: live
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: registry
respond:
- action: report
  metadata:
    author: frack113
    description: Detects the usage of "pypykatz" to obtain stored credentials. Adversaries
      may attempt to extract credential material from the Security Account Manager
      (SAM) database through Windows registry where the SAM database is stored
    falsepositives:
    - Unknown
    level: high
    references:
    - https://github.com/skelsec/pypykatz
    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003.002/T1003.002.md#atomic-test-2---registry-parse-with-pypykatz
    tags:
    - attack.credential-access
    - attack.t1003.002
  name: HackTool - Pypykatz Credentials Dumping Activity

