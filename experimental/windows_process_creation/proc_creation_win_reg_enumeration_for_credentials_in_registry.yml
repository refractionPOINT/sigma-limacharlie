detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - op: and
      rules:
      - case sensitive: false
        op: ends with
        path: event/FILE_PATH
        value: \reg.exe
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: ' query '
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: '/t '
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: REG_SZ
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: /s
    - op: or
      rules:
      - op: and
        rules:
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: '/f '
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: HKLM
      - op: and
        rules:
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: '/f '
        - case sensitive: false
          op: contains
          path: event/COMMAND_LINE
          value: HKCU
      - case sensitive: false
        op: contains
        path: event/COMMAND_LINE
        value: HKCU\Software\SimonTatham\PuTTY\Sessions
respond:
- action: report
  metadata:
    author: frack113
    description: 'Adversaries may search the Registry on compromised systems for insecurely
      stored credentials.

      The Windows Registry stores configuration information that can be used by the
      system or other programs.

      Adversaries may query the Registry looking for credentials and passwords that
      have been stored for use by other programs or services

      '
    falsepositives:
    - Unknown
    level: medium
    references:
    - https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.002/T1552.002.md
    tags:
    - attack.credential-access
    - attack.t1552.002
  name: Enumeration for Credentials in Registry

