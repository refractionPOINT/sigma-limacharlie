detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: or
    rules:
    - case sensitive: false
      op: matches
      path: event/COMMAND_LINE
      re: .*ipconfig.*\|.*find.*
    - case sensitive: false
      op: matches
      path: event/COMMAND_LINE
      re: .*net.*\|.*find.*
    - case sensitive: false
      op: matches
      path: event/COMMAND_LINE
      re: .*netstat.*\|.*find.*
    - case sensitive: false
      op: matches
      path: event/COMMAND_LINE
      re: .*ping.*\|.*find.*
    - case sensitive: false
      op: matches
      path: event/COMMAND_LINE
      re: .*systeminfo.*\|.*find.*
    - case sensitive: false
      op: matches
      path: event/COMMAND_LINE
      re: .*tasklist.*\|.*find.*
    - case sensitive: false
      op: matches
      path: event/COMMAND_LINE
      re: .*whoami.*\|.*find.*
respond:
- action: report
  metadata:
    author: Nasreddine Bencherchali (Nextron Systems), frack113
    description: 'Detects the execution of a potential recon command where the results
      are piped to "findstr". This is meant to trigger on inline calls of "cmd.exe"
      via the "/c" or "/k" for example.

      Attackers often time use this technique to extract specific information they
      require in their reconnaissance phase.

      '
    falsepositives:
    - Unknown
    level: medium
    references:
    - https://github.com/redcanaryco/atomic-red-team/blob/02cb591f75064ffe1e0df9ac3ed5972a2e491c97/atomics/T1057/T1057.md#atomic-test-6---discover-specific-process---tasklist
    - https://www.hhs.gov/sites/default/files/manage-engine-vulnerability-sector-alert-tlpclear.pdf
    - https://www.trendmicro.com/en_us/research/22/d/spring4shell-exploited-to-deploy-cryptocurrency-miners.html
    tags:
    - attack.discovery
    - attack.t1057
  name: Recon Command Output Piped To Findstr.EXE

