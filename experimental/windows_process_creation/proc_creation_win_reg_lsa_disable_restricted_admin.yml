detect:
  events:
  - NEW_PROCESS
  - EXISTING_PROCESS
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: \System\CurrentControlSet\Control\Lsa\
    - case sensitive: false
      op: contains
      path: event/COMMAND_LINE
      value: DisableRestrictedAdmin
respond:
- action: report
  metadata:
    author: frack113
    description: 'Detects changes to the "DisableRestrictedAdmin" registry value in
      order to disable or enable RestrictedAdmin mode.

      RestrictedAdmin mode prevents the transmission of reusable credentials to the
      remote system to which you connect using Remote Desktop.

      This prevents your credentials from being harvested during the initial connection
      process if the remote server has been compromise

      '
    falsepositives:
    - Unknown
    level: high
    references:
    - https://github.com/redcanaryco/atomic-red-team/blob/a8e3cf63e97b973a25903d3df9fd55da6252e564/atomics/T1112/T1112.md
    - https://social.technet.microsoft.com/wiki/contents/articles/32905.remote-desktop-services-enable-restricted-admin-mode.aspx
    tags:
    - attack.defense_evasion
    - attack.t1112
  name: RestrictedAdminMode Registry Value Tampering - ProcCreation

