detect:
  log type: wel
  op: and
  rules:
  - op: and
    rules:
    - case sensitive: false
      op: is
      path: Event/System/EventID
      value: '300'
    - case sensitive: false
      op: starts with
      path: Event/EventData/TargetUserSid
      value: S-1-5-21-
    - op: or
      rules:
      - case sensitive: false
        op: contains
        path: Event/EventData/SidList
        value: S-1-5-32-544
      - case sensitive: false
        op: contains
        path: Event/EventData/SidList
        value: -500}
      - case sensitive: false
        op: contains
        path: Event/EventData/SidList
        value: -518}
      - case sensitive: false
        op: contains
        path: Event/EventData/SidList
        value: -519}
  - not: true
    op: or
    rules:
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetUserSid
      value: '-500'
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetUserSid
      value: '-518'
    - case sensitive: false
      op: ends with
      path: Event/EventData/TargetUserSid
      value: '-519'
  target: log
respond:
- action: report
  metadata:
    author: frack113
    description: Detect standard users login that are part of high privileged groups
      such as the Administrator group
    falsepositives:
    - Standard domain users who are part of the administrator group. These users shouldn't
      have these right. But in the case where it's necessary. They should be filtered
      out using the "TargetUserName" field
    level: medium
    references:
    - https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-identifiers
    - https://learn.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/configuring-additional-lsa-protection
    - https://github.com/nasbench/EVTX-ETW-Resources/blob/7a806a148b3d9d381193d4a80356016e6e8b1ee8/ETWProvidersManifests/Windows11/22H2/W11_22H2_Pro_20221220_22621.963/WEPExplorer/LsaSrv.xml
    tags:
    - attack.credential_access
    - attack.privilege_escalation
  name: Standard User In High Privileged Group

