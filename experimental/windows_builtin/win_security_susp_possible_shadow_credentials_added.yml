detect:
  log type: wel
  op: and
  rules:
  - case sensitive: false
    op: is
    path: Event/System/EventID
    value: '5136'
  - case sensitive: false
    op: is
    path: Event/EventData/AttributeLDAPDisplayName
    value: msDS-KeyCredentialLink
  target: log
respond:
- action: report
  metadata:
    author: Nasreddine Bencherchali (Nextron Systems), Elastic (idea)
    description: Detects possible addition of shadow credentials to an active directory
      object.
    falsepositives:
    - Modifications in the msDS-KeyCredentialLink attribute can be done legitimately
      by the Azure AD Connect synchronization account or the ADFS service account.
      These accounts can be added as Exceptions. (From elastic FP section)
    level: high
    references:
    - https://www.elastic.co/guide/en/security/8.4/potential-shadow-credentials-added-to-ad-object.html
    - https://cyberstoph.org/posts/2022/03/detecting-shadow-credentials/
    - https://twitter.com/SBousseaden/status/1581300963650187264?
    tags:
    - attack.credential-access
    - attack.t1556
  name: Possible Shadow Credentials Added

