detect:
  event: WEL
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - case sensitive: false
      op: is
      path: event/EVENT/EventData/Provider_Name
      value: Microsoft-Windows-Security-Auditing
    - case sensitive: false
      op: is
      path: event/EVENT/System/EventID
      value: '5145'
    - op: or
      rules:
      - case sensitive: false
        op: contains
        path: event/EVENT/EventData/RelativeTargetName
        value: \mimidrv
      - case sensitive: false
        op: contains
        path: event/EVENT/EventData/RelativeTargetName
        value: \lsass
      - case sensitive: false
        op: contains
        path: event/EVENT/EventData/RelativeTargetName
        value: \windows\minidump\
      - case sensitive: false
        op: contains
        path: event/EVENT/EventData/RelativeTargetName
        value: \hiberfil
      - case sensitive: false
        op: contains
        path: event/EVENT/EventData/RelativeTargetName
        value: \sqldmpr
      - case sensitive: false
        op: contains
        path: event/EVENT/EventData/RelativeTargetName
        value: \sam
      - case sensitive: false
        op: contains
        path: event/EVENT/EventData/RelativeTargetName
        value: \ntds.dit
      - case sensitive: false
        op: contains
        path: event/EVENT/EventData/RelativeTargetName
        value: \security
respond:
- action: report
  metadata:
    author: Teymur Kheirkhabarov, oscd.community
    description: Transferring files with well-known filenames (sensitive files with
      credential data) using network shares
    falsepositives:
    - Transferring sensitive files for legitimate administration work by legitimate
      administrator
    level: medium
    references:
    - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment
    tags:
    - attack.credential_access
    - attack.t1003.002
    - attack.t1003.001
    - attack.t1003.003
  name: Transferring Files with Credential Data via Network Shares

