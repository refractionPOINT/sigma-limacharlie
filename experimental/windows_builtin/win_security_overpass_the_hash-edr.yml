detect:
  event: WEL
  op: and
  rules:
  - op: is windows
  - op: and
    rules:
    - case sensitive: false
      op: is
      path: event/EVENT/System/EventID
      value: '4624'
    - case sensitive: false
      op: is
      path: event/EVENT/EventData/LogonType
      value: '9'
    - case sensitive: false
      op: is
      path: event/EVENT/EventData/LogonProcessName
      value: seclogo
    - case sensitive: false
      op: is
      path: event/EVENT/EventData/AuthenticationPackageName
      value: Negotiate
respond:
- action: report
  metadata:
    author: Roberto Rodriguez (source), Dominik Schaudel (rule)
    description: Detects successful logon with logon type 9 (NewCredentials) which
      matches the Overpass the Hash behavior of e.g Mimikatz's sekurlsa::pth module.
    falsepositives:
    - Runas command-line tool using /netonly parameter
    level: high
    references:
    - https://web.archive.org/web/20220419045003/https://cyberwardog.blogspot.com/2017/04/chronicles-of-threat-hunter-hunting-for.html
    tags:
    - attack.lateral_movement
    - attack.s0002
    - attack.t1550.002
  name: Successful Overpass the Hash Attempt

