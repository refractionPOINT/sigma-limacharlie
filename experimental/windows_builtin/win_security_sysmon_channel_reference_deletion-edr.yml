detect:
  event: WEL
  op: and
  rules:
  - op: is windows
  - op: or
    rules:
    - op: and
      rules:
      - case sensitive: false
        op: is
        path: event/EVENT/System/EventID
        value: '4657'
      - op: or
        rules:
        - case sensitive: false
          op: contains
          path: event/EVENT/EventData/ObjectName
          value: WINEVT\Publishers\{5770385f-c22a-43e0-bf4c-06f5698ffbd9}
        - case sensitive: false
          op: contains
          path: event/EVENT/EventData/ObjectName
          value: WINEVT\Channels\Microsoft-Windows-Sysmon/Operational
      - case sensitive: false
        op: is
        path: event/EVENT/EventData/ObjectValueName
        value: Enabled
      - case sensitive: false
        op: is
        path: event/EVENT/EventData/NewValue
        value: '0'
    - op: and
      rules:
      - case sensitive: false
        op: is
        path: event/EVENT/System/EventID
        value: '4663'
      - op: or
        rules:
        - case sensitive: false
          op: contains
          path: event/EVENT/EventData/ObjectName
          value: WINEVT\Publishers\{5770385f-c22a-43e0-bf4c-06f5698ffbd9}
        - case sensitive: false
          op: contains
          path: event/EVENT/EventData/ObjectName
          value: WINEVT\Channels\Microsoft-Windows-Sysmon/Operational
      - case sensitive: false
        op: is
        path: event/EVENT/EventData/AccessMask
        value: '65536'
respond:
- action: report
  metadata:
    author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)
    description: Potential threat actor tampering with Sysmon manifest and eventually
      disabling it
    falsepositives:
    - Unknown
    level: high
    references:
    - https://twitter.com/Flangvik/status/1283054508084473861
    - https://twitter.com/SecurityJosh/status/1283027365770276866
    - https://securityjosh.github.io/2020/04/23/Mute-Sysmon.html
    - https://gist.github.com/Cyb3rWard0g/cf08c38c61f7e46e8404b38201ca01c8
    tags:
    - attack.defense-evasion
    - attack.t1112
  name: Sysmon Channel Reference Deletion

